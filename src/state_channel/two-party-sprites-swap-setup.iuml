@startuml
actor Alice as A

box "Blockchain" #lightblue
    participant "WETH Channel" as wethch
    participant "ASD Channel" as asdch
    participant "WETH token" as weth
    participant "ASD token" as asd
    participant "Orders" as O
    participant "Preimage\nManager" as pm
    end box

actor Bob as B

note over weth: **Balances**:\n  50 WETH — Alice\n  10 WETH — WETH Channel
note over asd: **Balances**:\n  80 ASD — Bob\n  20 ASD — ASD Channel

note over wethch: **ch-WETH** @ round 0\n**Alice**\n  10 deposit
note over asdch: **ch-ASD** @ round 0\n**Bob**\n  20 deposit

group Order
    note over B: Sell 5 ASD\nBuy 7 WETH
    B -> O:
    O -> A:
end

group Conditional transfer
    note over A: generate secret Secret\nh = Hash(Secret)
    note over A: **ch-WETH** @ round 1\n**Alice**\n  10 WETH deposit\nPayment(to Bob, h, 7)\nSig(Alice)
    A -> B: send payment
    B -> B: verify
    note over B: **ch-ASD** @ round 1\n**Bob**\n  20 deposit\nPayment(to Alice, h, 5)\nSig(Bob)
    B -> A: send payment
    A -> A: verify
end

group Secret exchange
 A -> B: Secret
 B -> B: verify \n Hash(Secret) = h
end

@enduml

@startuml
!pragma teoz true

title Two party swap via trusted DEX
' Assume we have an open channel with sufficient deposit
actor Alice as A

box "Blockchain" #lightblue
    participant "WETH Channel\nAlice-DEX" as wethalice
    participant "ASD Channel\nAlice-DEX" as asdalice
    participant "DEX" as dex
    participant "WETH Channel\nBob-DEX" as wethbob
    participant "ASD Channel\nBob-DEX" as asdbob
    ' participant "WETH token" as weth
    ' participant "ASD token" as asd
    participant "Orders" as O
    end box

actor Bob as B

' note over weth: **Balances**:\n  50 Alice\n  10 Alice-Dex\n100 Bob-Dex
' / note over asd: **Balances**:\n  80 Bob\n  20 Bob-Dex\n  10 Alice-Dex

note over wethalice: round 0\n**Alice**\n  10 deposit
/ note over asdalice: round 0\n**DEX**\n  10 deposit
/ note over wethbob: round 0\n**DEX**\n  100 deposit
/ note over asdbob: round 0\n**Bob**\n  20 deposit



group Order
    note over B: Sell 5 ASD\nBuy 7 WETH
    B -> O:
    O -> A:
end

group Unconditional transfer to DEX

    A -> dex: 7 WETH
    B -> dex: 5 ASD

    note over wethalice: round 1\n**Alice**\n  -7 credit\n**DEX**\n  7 credit
    / note over asdbob: round 1\n**Bob**\n  -5 credit\n**DEX**\n 5 credit

end

group Unconditional transfer to Users

    dex -> B: 7 WETH
    dex -> A: 5 ASD

    note over wethbob: round 1\n**Bob**\n  7 credit\n**DEX**\n  -7 credit
    / note over asdalice: round 1\n**Alice**\n  5 credit\n**DEX**\n  -5 credit

end




' note over weth: **Balances**:\n  53 WETH — Alice\n  7 WETH — Bob\n  0 WETH — WETH Channel
' / note over asd: **Balances**:\n  5 ASD — Alice\n  95 ASD — Bob\n  0 ASD — ASD Channel

@enduml
